<div class="event-comparison-container">
  @if (hasComparison()) {
    <h2>{{ i18n.t('comparison.title') }}</h2>

    <nav class="tab-bar" role="tablist">
      <button
        class="tab-btn icon-hover"
        [class.active]="activeTab() === 'alerts'"
        (click)="setActiveTab('alerts')"
        role="tab"
        [attr.aria-selected]="activeTab() === 'alerts'"
      >
        <span class="icon icon-bell" aria-hidden="true"></span>
        {{ i18n.t('alerts.tabAlerts') }}
        @if (alertBadgeCount() > 0) {
          <span class="tab-badge warning">{{ alertBadgeCount() }}</span>
        }
      </button>
      <button
        class="tab-btn icon-hover"
        [class.active]="activeTab() === 'differences'"
        (click)="setActiveTab('differences')"
        role="tab"
        [attr.aria-selected]="activeTab() === 'differences'"
      >
        <span class="icon icon-search" aria-hidden="true"></span>
        {{ i18n.t('alerts.tabDifferences') }}
        @if (differences().length > 0) {
          <span class="tab-badge amber">{{ differences().length }}</span>
        }
      </button>
      <button
        class="tab-btn icon-hover"
        [class.active]="activeTab() === 'details'"
        (click)="setActiveTab('details')"
        role="tab"
        [attr.aria-selected]="activeTab() === 'details'"
      >
        <span class="icon icon-clipboard" aria-hidden="true"></span>
        {{ i18n.t('alerts.tabDetails') }}
      </button>
    </nav>

    <div class="tab-content">
      <!-- Alerts Tab -->
      @if (activeTab() === 'alerts') {
          <div class="alerts-panel" role="tabpanel">
            <div class="alert-config">
              <span class="config-title">
                <span class="icon icon-gear" aria-hidden="true"></span>
                {{ i18n.t('alerts.config.title') }}
              </span>
            <div class="config-fields">
              <label class="config-label">
                {{ i18n.t('alerts.config.polVdHours') }}
                <input
                  type="number"
                  class="config-input"
                  min="1"
                  [value]="alertService.polVdThresholdHours()"
                  (change)="onPolThresholdChange($any($event.target).value)"
                />
              </label>
              <label class="config-label">
                {{ i18n.t('alerts.config.podVaHours') }}
                <input
                  type="number"
                  class="config-input"
                  min="1"
                  [value]="alertService.podVaThresholdHours()"
                  (change)="onPodThresholdChange($any($event.target).value)"
                />
              </label>
            </div>
          </div>

          @if (alertService.alerts().length === 0) {
            <div class="no-alerts">
              <p>
                <span class="icon icon-check" aria-hidden="true"></span>
                {{ i18n.t('alerts.noAlerts') }}
              </p>
            </div>
          } @else {
            @if (alertService.warningAlerts().length > 0) {
              <div class="alert-section warning-section">
                <h4 class="alert-section-title warning-title">
                  <span class="icon icon-alert" aria-hidden="true"></span>
                  {{ i18n.t('alerts.warningSection') }}
                </h4>
                <ul class="alert-list">
                  @for (alert of alertService.warningAlerts(); track alert.message) {
                    <li class="alert-item warning-item">
                      <span class="alert-icon">
                        <span class="icon icon-alert" aria-hidden="true"></span>
                      </span>
                      <span class="alert-category">{{ alert.category }}</span>
                      <span class="alert-message">{{ alert.message }}</span>
                    </li>
                  }
                </ul>
              </div>
            }

            @if (alertService.infoAlerts().length > 0) {
              <div class="alert-section info-section">
                <h4 class="alert-section-title info-title">
                  <span class="icon icon-info" aria-hidden="true"></span>
                  {{ i18n.t('alerts.infoSection') }}
                </h4>
                <ul class="alert-list">
                  @for (alert of alertService.infoAlerts(); track alert.message) {
                    <li class="alert-item info-item">
                      <span class="alert-icon">
                        <span class="icon icon-info" aria-hidden="true"></span>
                      </span>
                      <span class="alert-category">{{ alert.category }}</span>
                      <span class="alert-message">{{ alert.message }}</span>
                    </li>
                  }
                </ul>
              </div>
            }
          }
        </div>
      }

      <!-- Differences Tab -->
        @if (activeTab() === 'differences') {
          <div class="differences-panel" role="tabpanel">
            @if (differences().length > 0) {
              <div class="differences-section">
                <h3>{{ i18n.t('comparison.keyDifferences') }}</h3>
                <ul class="differences-list">
                  @for (diff of differences(); track diff) {
                    <li>{{ diff }}</li>
                  }
                </ul>
              </div>
            } @else {
              <div class="no-differences">
                <p>
                  <span class="icon icon-check" aria-hidden="true"></span>
                  {{ i18n.t('comparison.noDifferences') }}
                </p>
              </div>
            }
          </div>
        }

      <!-- Details Tab -->
      @if (activeTab() === 'details') {
        <div class="details-panel" role="tabpanel">
          <div class="comparison-grid">
            <div class="comparison-column">
              <h3 class="column-header primary">
                {{ i18n.t('comparison.primaryHeader') }}
              </h3>
              <div class="shipment-info">
                @if (primaryEvent()?.shipmentId) {
                  <div class="info-item">
                    <strong>{{ i18n.t('comparison.label.shipmentId') }}</strong>
                    {{ primaryEvent()?.shipmentId }}
                  </div>
                }
                @if (primaryEvent()?.origin) {
                  <div class="info-item">
                    <strong>{{ i18n.t('comparison.label.origin') }}</strong>
                    {{ primaryEvent()?.origin }}
                  </div>
                }
                @if (primaryEvent()?.destination) {
                  <div class="info-item">
                    <strong>{{ i18n.t('comparison.label.destination') }}</strong>
                    {{ primaryEvent()?.destination }}
                  </div>
                }
                <div class="info-item">
                  <strong>{{ i18n.t('comparison.label.totalEvents') }}</strong>
                  {{ primarySortedEvents().length }}
                </div>
              </div>
              <div class="events-list">
                @for (event of primarySortedEvents(); track event.eventDateTime) {
                  <div class="event-card">
                    <div class="event-type">{{ event.eventType }}</div>
                    <div class="event-date">
                      {{ event.eventDateTime | date: 'short' }}
                    </div>
                    @if (event.location) {
                      <div class="event-location">
                        <span class="icon icon-pin" aria-hidden="true"></span>
                        {{ event.location }}
                      </div>
                    }
                  </div>
                }
              </div>
            </div>

            <div class="comparison-column">
              <h3 class="column-header secondary">
                {{ i18n.t('comparison.secondaryHeader') }}
              </h3>
              <div class="shipment-info">
                @if (secondaryEvent()?.shipmentId) {
                  <div class="info-item">
                    <strong>{{ i18n.t('comparison.label.shipmentId') }}</strong>
                    {{ secondaryEvent()?.shipmentId }}
                  </div>
                }
                @if (secondaryEvent()?.origin) {
                  <div class="info-item">
                    <strong>{{ i18n.t('comparison.label.origin') }}</strong>
                    {{ secondaryEvent()?.origin }}
                  </div>
                }
                @if (secondaryEvent()?.destination) {
                  <div class="info-item">
                    <strong>{{ i18n.t('comparison.label.destination') }}</strong>
                    {{ secondaryEvent()?.destination }}
                  </div>
                }
                <div class="info-item">
                  <strong>{{ i18n.t('comparison.label.totalEvents') }}</strong>
                  {{ secondarySortedEvents().length }}
                </div>
              </div>
              <div class="events-list">
                @for (
                  event of secondarySortedEvents();
                  track event.eventDateTime
                ) {
                  <div class="event-card">
                    <div class="event-type">{{ event.eventType }}</div>
                    <div class="event-date">
                      {{ event.eventDateTime | date: 'short' }}
                    </div>
                    @if (event.location) {
                      <div class="event-location">
                        <span class="icon icon-pin" aria-hidden="true"></span>
                        {{ event.location }}
                      </div>
                    }
                  </div>
                }
              </div>
            </div>
          </div>
        </div>
      }
    </div>
  } @else {
    <div class="no-comparison" role="status" aria-live="polite">
      <p>
        <span class="icon icon-hourglass" aria-hidden="true"></span>
        {{ i18n.t('comparison.noComparison') }}
      </p>
    </div>
  }
</div>
