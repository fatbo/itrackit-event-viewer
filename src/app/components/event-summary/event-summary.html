<div class="event-summary-container">
  @if (primaryEvent()) {
    <div class="summary-header">
      <h2>{{ i18n.t('summary.title') }}</h2>
    </div>
    <div class="indicator-pills">
      @if (shipmentStatus()) {
        <span
          class="pill pill-status"
          [ngClass]="'pill-status-' + shipmentStatus().tone"
          [title]="shipmentStatus().description"
        >
          {{ shipmentStatus().label }}
        </span>
      }
      @if (hasReeferData()) {
        <span class="pill pill-reefer" title="{{ i18n.t('summary.indicator.reeferTitle') }}">
          <span class="icon icon-snow" aria-hidden="true"></span>
          {{ i18n.t('summary.indicator.reeferLabel') }}
        </span>
      }
      @if (hasDangerousGoods()) {
        <span class="pill pill-dg" title="{{ i18n.t('summary.indicator.dangerousGoods') }}">
          <span class="icon icon-alert" aria-hidden="true"></span>
          DG
        </span>
      }
      @if (hasDamages()) {
        <span class="pill pill-dmg" title="{{ i18n.t('summary.indicator.damage') }}">
          <span class="icon icon-damage" aria-hidden="true"></span>
          DMG
        </span>
      }
    </div>
    
    <div class="summary-grid">
      @if (shipmentStatus()) {
        <div
          class="summary-item summary-item-status"
          [ngClass]="'summary-item-status-' + shipmentStatus().tone"
        >
          <span class="label">{{ i18n.t('summary.label.shipmentStatus') }}</span>
          <span class="value">{{ shipmentStatus().label }}</span>
          <span class="status-note">{{ shipmentStatus().description }}</span>
        </div>
      }
      @if (primaryEvent()?.shipmentId) {
        <div class="summary-item">
          <span class="label">{{ i18n.t('summary.label.shipmentId') }}</span>
          <span class="value">{{ primaryEvent()?.shipmentId }}</span>
        </div>
      }
      
      @if (primaryEvent()?.blNo) {
        <div class="summary-item">
          <span class="label">{{ i18n.t('summary.label.blNumber') }}</span>
          <span class="value">{{ primaryEvent()?.blNo }}</span>
        </div>
      }
      
      @if (primaryEvent()?.bookingNumber) {
        <div class="summary-item">
          <span class="label">{{ i18n.t('summary.label.bookingNumber') }}</span>
          <span class="value">{{ primaryEvent()?.bookingNumber }}</span>
        </div>
      }
      
      @if (primaryEvent()?.containerNumber) {
        <div class="summary-item">
          <span class="label">{{ i18n.t('summary.label.containerNumber') }}</span>
          <span class="value">{{ primaryEvent()?.containerNumber }}</span>
        </div>
      }
      
      @if (primaryEvent()?.containerSize || primaryEvent()?.containerType) {
        <div class="summary-item">
          <span class="label">{{ i18n.t('summary.label.containerSizeType') }}</span>
          <span class="value">{{ primaryEvent()?.containerSize || '' }} {{ primaryEvent()?.containerType || '' }}</span>
        </div>
      }
      
      @if (primaryEvent()?.containerISOCode) {
        <div class="summary-item">
          <span class="label">{{ i18n.t('summary.label.containerIsoCode') }}</span>
          <span class="value">{{ primaryEvent()?.containerISOCode }}</span>
        </div>
      }
      
      @if (primaryEvent()?.shipmentType) {
        <div class="summary-item">
          <span class="label">{{ i18n.t('summary.label.shipmentType') }}</span>
          <span class="value">{{ shipmentTypeLabel() }} <span class="value-code">({{ primaryEvent()?.shipmentType }})</span></span>
        </div>
      }
      
      @if (primaryEvent()?.carrier) {
        <div class="summary-item">
          <span class="label">{{ i18n.t('summary.label.shippingLine') }}</span>
          <span class="value">{{ primaryEvent()?.carrier }}</span>
        </div>
      }
      
      @if (primaryEvent()?.origin) {
        <div class="summary-item">
          <span class="label">{{ i18n.t('summary.label.originPol') }}</span>
          <span class="value">{{ primaryEvent()?.origin }}</span>
        </div>
      }
      
      @if (primaryEvent()?.destination) {
        <div class="summary-item">
          <span class="label">{{ i18n.t('summary.label.destinationPod') }}</span>
          <span class="value">{{ primaryEvent()?.destination }}</span>
        </div>
      }

      @if (primaryEvent()?.sealNo?.length) {
        <div class="summary-item">
          <span class="label">{{ i18n.t('summary.label.sealNumbers') }}</span>
          <span class="value">
            @for (seal of primaryEvent()?.sealNo; track seal) {
              <span class="seal-tag">
                <span class="icon icon-lock" aria-hidden="true"></span>
                {{ seal }}
              </span>
            }
          </span>
        </div>
      }

      @if (hasDangerousGoods()) {
        <div class="summary-item summary-item-dg">
          <span class="label">{{ i18n.t('summary.label.dangerousGoods') }}</span>
          <span class="value">
            @for (code of primaryEvent()?.dg; track code) {
              <span class="pill pill-dg-inline">
                <span class="icon icon-alert" aria-hidden="true"></span>
                {{ code }}
              </span>
            }
          </span>
        </div>
      }

      @if (hasDamages()) {
        <div class="summary-item summary-item-dmg">
          <span class="label">{{ i18n.t('summary.label.damages') }}</span>
          <span class="value">
            @for (damage of primaryEvent()?.dmg; track damage) {
              <span class="pill pill-dmg-inline">
                <span class="icon icon-damage" aria-hidden="true"></span>
                {{ damage }}
              </span>
            }
          </span>
        </div>
      }

      @if (hasReeferData() && reeferData()) {
        <div class="summary-item summary-item-reefer" [ngClass]="{'summary-item-reefer-alert': isReeferTempAlert()}">
          <span class="label">{{ i18n.t('summary.label.reeferInfo') }}</span>
          <div class="value reefer-details">
            <div class="reefer-temp">
              <span class="reefer-label">{{ i18n.t('summary.label.reeferRequiredTemp') }}</span>
              <span class="reefer-value">{{ reeferData()?.requireTemp }}°{{ reeferData()?.requireTempUnit }}</span>
            </div>
            <div class="reefer-temp" [ngClass]="{'reefer-temp-alert': isReeferTempAlert()}">
              <span class="reefer-label">{{ i18n.t('summary.label.reeferReadingTemp') }}</span>
              <span class="reefer-value">{{ reeferData()?.readingTemp }}°{{ reeferData()?.readingTempUnit }}</span>
              @if (isReeferTempAlert()) {
                <span class="reefer-alert-icon" title="{{ i18n.t('summary.label.reeferAlert') }}">
                  <span class="icon icon-alert" aria-hidden="true"></span>
                </span>
              }
            </div>
            <div class="reefer-time">
              <span class="reefer-label">{{ i18n.t('summary.label.reeferReadingTime') }}</span>
              <span class="reefer-value">{{ reeferData()?.readingTime | date:'medium' }}</span>
            </div>
          </div>
        </div>
      }
      
      @if (primaryEvent()?.containerWeight) {
        <div class="summary-item">
          <span class="label">{{ i18n.t('summary.label.containerWeight') }}</span>
          <span class="value">{{ primaryEvent()?.containerWeight }} kg</span>
        </div>
      }

      @if (primaryEvent()?.source) {
        <div class="summary-item">
          <span class="label">{{ i18n.t('summary.label.source') }}</span>
          <span class="value">{{ primaryEvent()?.source }}</span>
        </div>
      }

      @if (voyageProgress()) {
        <div class="summary-item summary-item-progress">
          <span class="label">{{ i18n.t('summary.label.voyageProgress') }}</span>
          <div class="value">
            <div class="progress-bar">
              <div class="progress-fill" [style.width.%]="voyageProgress()!.percent"></div>
            </div>
            <span class="progress-text">{{ i18n.t('summary.label.voyageProgressValue', { percent: voyageProgress()!.percent, completed: voyageProgress()!.completedLegs, total: voyageProgress()!.totalLegs }) }}</span>
          </div>
        </div>
      }
      
      <div class="summary-item">
        <span class="label">{{ i18n.t('summary.label.totalEquipmentEvents') }}</span>
        <span class="value">{{ eventCount() }}</span>
      </div>

      @if (transportEventCount() > 0) {
        <div class="summary-item">
          <span class="label">{{ i18n.t('summary.label.totalTransportEvents') }}</span>
          <span class="value">{{ transportEventCount() }}</span>
        </div>
      }
      
      @if (firstEvent()) {
        <div class="summary-item">
          <span class="label">{{ i18n.t('summary.label.firstEvent') }}</span>
          <span class="value">{{ getEventTypeLabel(firstEvent()) }} - {{ firstEvent()?.eventDateTime | date:'medium' }}</span>
        </div>
      }
      
      @if (lastEvent()) {
        <div class="summary-item">
          <span class="label">{{ i18n.t('summary.label.latestEvent') }}</span>
          <span class="value">{{ getEventTypeLabel(lastEvent()) }} - {{ lastEvent()?.eventDateTime | date:'medium' }}</span>
        </div>
      }
    </div>
  } @else {
    <div class="no-data">
      <p>{{ i18n.t('summary.noData') }}</p>
    </div>
  }
</div>
